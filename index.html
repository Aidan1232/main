<!DOCTYPE html>
<html>
<head>
  <title>PeerJS Video Chat</title>
  <style>
    body { font-family: Arial; text-align: center; }
    video { width: 300px; border: 2px solid black; margin: 10px; }
    #my-id { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Peer-to-Peer Video Chat</h1>
  <p>Your ID: <span id="my-id">...</span></p>
  <video id="my-video" autoplay muted></video>
  <video id="remote-video" autoplay></video>
  <br>
  <input id="peer-id-input" placeholder="Enter Peer ID to call">
  <button id="callBtn" onclick="callPeer()" disabled>Call</button>

  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
  <script>
    const myVideo = document.getElementById('my-video');
    const remoteVideo = document.getElementById('remote-video');
    const myIdDisplay = document.getElementById('my-id');
    const peer = new Peer(); // Use default PeerJS cloud server

    let localStream;

    // Get webcam/mic
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        myVideo.srcObject = stream;
        localStream = stream;
        document.getElementById('callBtn').disabled = false;
      })
      .catch(err => console.error('Media error:', err));

    // When PeerJS connects and gives you an ID
    peer.on('open', id => {
      myIdDisplay.textContent = id;
    });

    // When someone calls you
    peer.on('call', call => {
      call.answer(localStream); // Answer with our stream
      call.on('stream', remoteStream => {
        remoteVideo.srcObject = remoteStream;
      });
    });

    function callPeer() {
      if (!localStream) {
        alert("Stream not ready yet. Please wait...");
        return;
      }

    const peerId = document.getElementById('peer-id-input').value;
    if (!peerId) {
        alert("Enter a peer ID to call.");
        return;
    }

    const call = peer.call(peerId, localStream);
    if (!call) {
        alert("Call failed. Check Peer ID.");
        return;
    }

    call.on('stream', remoteStream => {
        remoteVideo.srcObject = remoteStream;
    });
    }
  </script>
</body>
</html>
